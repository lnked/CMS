"use strict";!function(e){e.console=e.console||{};for(var t,n,i=e.console,o={},a=function(){},l="memory".split(","),r="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=l.pop();)i[t]||(i[t]=o);for(;n=r.pop();)i[n]||(i[n]=a)}("undefined"==typeof window?void 0:window),navigator.userAgent.toLowerCase().indexOf("chrome");var category,controls,cp=function(c){var n,i,t=[];return{addTemplate:function(e){c("#addtemplate").find("input").attr("disabled",!1),c("#addtemplate").toggle()},addTemplateFile:function(a){var e=c("#template_name").val(),t=c("#template_file").val();c.ajax({url:"/"+ADMIN_DIR+"/ajax/structure/",type:"post",data:{act:"ajaxAddTemplate",name:e,file:t},success:function(e){if(e.length){var t=[];for(var n in e){var i=e[n],o=a==i.id?" selected":"";t.push('<option value="'+i.id+'"'+o+">"+i.name+"</option>")}c("#select_field").html('<select name="stc_tid" id="templates_list">'+t.join("")+"</select>"),selectize("#templates_list")}c("#addtemplate").find("input").attr("disabled",!0),c("#addtemplate").hide()},dataType:"JSON"})},dropdown:function(){c(".trigger-dropdown").on("click",function(){var e=c(this).data("toggle");c("#dropdown-"+e).toggle()})},cleditor:function(){void 0!==jQuery.cleditor&&c(".redactor_cleditor").cleditor()},notify:function(e,t){clearTimeout(n),c("body").find(".notify-message").length||(i=c('<div class="notify notify-message">'+e+"</div>"),c("body").append(i),setTimeout(function(){i.addClass("animate")},10)),n=setTimeout(function(){i.removeClass("animate"),setTimeout(function(){i.remove()},300)},2500)},fileChange:function(e){var t=e.value;if(t.lastIndexOf("\\"))var n=t.lastIndexOf("\\")+1;else n=t.lastIndexOf("/")+1;t=t.slice(n),c(e).closest(".file--upload").find(".file--upload-placehoder").html(t)},binding:function(e,t){c('input[name="'+e+'"]').on("keyup",function(){""!=this.value&&c('input[name="'+t+'"]').val(transliterate(this.value,URL_TRANSLATE))})},saveSettings:function(e,t){void 0!==t&&(t.preventDefault?t.preventDefault():t.returnValue=!1);var i={};return c("#settings-container-toggle-"+e).find("input, select").each(function(){var e=c(this).attr("type"),t=c(this).attr("name"),n=c(this).val();void 0!==t&&("radio"!==e&&"checkbox"!==e||!0===c(this).is(":checked"))&&(t=t.replace("SETTINGS_",""),i[t]=n)}),c.post("/"+ADMIN_DIR+"/structure/saveSettings/",{arr:i},function(e){1==e.result&&cp.notify("Сохранено","success")},"JSON"),!1},removeSettings:function(t,e){return void 0!==e&&(e.preventDefault?e.preventDefault():e.returnValue=!1),cp.dialog("Вы дейсвительно хотите удалить блок?")&&c.post("/"+ADMIN_DIR+"/structure/removeSettings/",{id:t},function(e){1==e.result&&(c("#settings-"+t).remove(),c("#breadcrumbs-"+t).remove(),c("#container-"+t).remove(),c("#emptysplash-"+t).remove())},"JSON"),!1},arrLength:function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},loadSettings:function(e,o,t){var a,l={1:"type",2:"item",3:"mode"},n="",i="",r=1;"type"==t?(r=1,n=e):"item"==t?(r=2,n=c("#cnt_"+l[1]+"-"+o).find("option:selected").val(),i=e):"mode"==t&&(r=3,n=c("#cnt_"+l[2]+"-"+o).find("option:selected").val(),i=e);for(var s=a=r+1;s<=4;s++)0<c("#block-lvl"+s+"-"+o).length&&c("#block-lvl"+s+"-"+o).remove();c.post("/"+ADMIN_DIR+"/structure/loadSettings/",{action:n,mode:i},function(e){if(void 0!==e&&0<cp.arrLength(e)){var t=[],n="cnt_"+l[a]+"-"+o;for(var i in t.push('<div class="block-settings-select-block lvl'+a+'" id="block-lvl'+a+"-"+o+'">'),t.push('<select name="SETTINGS_'+l[a]+"_"+o+'" id="'+n+'" onchange="cp.loadSettings(this.value, '+o+", '"+l[a]+"');\">"),t.push(' <option value="" selected>Выбрать</option>'),e)t.push('<option value="'+i+'">'+e[i]+"</option>");t.push("</select>"),t.push("</div>"),c("#block-settings-select-block-"+o).append(t.join("")),selectize("#"+n)}},"JSON")},toggleModule:function(t,e){void 0!==e&&(e.preventDefault?e.preventDefault():e.returnValue=!1);var n=c(t).attr("href");return c(t).append('<i class="loading"></i>'),c.post(n,function(e){!0===e.status&&(c(t).hasClass("icon-eye-off")?c(t).removeClass("icon-eye-off").addClass("icon-eye").html(""):c(t).removeClass("icon-eye").addClass("icon-eye-off").html(""))},"JSON"),!1},toggleSettings:function(e,t){void 0!==t&&(t.preventDefault?t.preventDefault():t.returnValue=!1);var n=c(e).attr("href").substr(1);return c(e).toggleClass("block-settings-open"),c("#"+n).toggle(),!1},tableToggle:function(e,t){void 0!==t&&(t.preventDefault?t.preventDefault():t.returnValue=!1);var n=window.location.pathname.replace(/\//g,"|"),i=e+"_toogle_"+md5(n);return void 0===t?void 0===c.cookie(i)&&(c("#"+e+" th .table_hdr").removeClass("table_u").addClass("table_d"),c("#"+e+" tr:not(.th)").hide()):(c("#"+e+" th .table_hdr").toggleClass("table_u").toggleClass("table_d"),c("#"+e+" tr:not(.th)").toggle(),c("#"+e+" tr:not(.th)").is(":visible")?c.cookie(i,"show",{expires:30,path:"/"}):c.removeCookie(i,{path:"/"})),!1},tableToggleList:function(){var e=window.location.pathname.replace(/\//g,"|"),n=md5(e);0<c(".table-toggle-trigger").length&&c(".table-toggle-trigger").each(function(){var e=this.id,t=e+"_toogle_"+n;void 0!==c.cookie(t)?(c("#"+e+" th .table_hdr").addClass("table_u").removeClass("table_d"),c("#"+e+" tr:not(.th)").show()):(c("#"+e+" th .table_hdr").removeClass("table_u").addClass("table_d"),c("#"+e+" tr:not(.th)").hide())})},addBlock:function(e,t){void 0!==t&&(t.preventDefault?t.preventDefault():t.returnValue=!1);var n=10;if(c("#cont_data").find(".block-settings-order-input").length){var i=[];c("#cont_data").find(".block-settings-order-input").each(function(){i.push(c(this).find("input").val())}),i.length&&(n=i.max()+10)}return c.post("/"+ADMIN_DIR+"/structure/getNewId/",{parent:e,order:n},function(e){var t=['<tr id="settings-'+e+'">','<td class="settings-row">','<div class="settings-container clearfix">','<a href="#" onclick="return cp.removeSettings('+e+', event);" class="block-settings-link block-settings-remove"><i class="icon icon-delete"></i>Удалить блок</a>','<a href="#settings-container-toggle-'+e+'" onclick="return cp.toggleSettings(this, event);" class="block-settings-link block-settings-title block-settings-open">','<span class="block-settings-title-drop"><i class="icon icon-cog"></i></span>','<span class="block-settings-title-text">Настройки блока</span>',"</a>",'<div class="settings-container-toggle opened" id="settings-container-toggle-'+e+'">','<div class="block-settings-ln block-settings-visible clearfix">','<div class="option-group option-combo option-simple">','<label><input type="radio" name="SETTINGS_visible_'+e+'" value="1" checked="checked"><span class="option">Активен</span></label>','<label class="disallow"><input type="radio" name="SETTINGS_visible_'+e+'" value="0"><span class="option">Не активен</span></label>',"</div>","</div>",'<div class="block-settings-ln block-settings-order clearfix">','<div class="block-settings-order-input">','<input name="SETTINGS_ord_'+e+'" value="'+n+'" placeholder="Порядок">',"</div>","</div>",'<div class="block-settings-ln block-settings-select clearfix" id="block-settings-select-block-'+e+'">','<div class="block-settings-select-block lvl1" id="block-lvl1-'+e+'">','<select name="SETTINGS_type_'+e+'" id="cnt_type-'+e+'" onchange="cp.loadSettings(this.value, '+e+', \'type\');"><option value="" selected>Выбрать</option><option value="redactor">Визуальный редактор</option><option value="editor">Редактор кода</option><option value="module">Модуль</option><option value="zone">Зона</option><option value="block">Блок</option><option value="banner">Баннер</option><option value="search">Поиск</option></select>',"</div>","</div>",'<div class="block-settings-ln block-settings-system clearfix">','<div class="block-settings-system-input">','<input name="SETTINGS_system_'+e+'" value="" placeholder="Системное имя">',"</div>","</div>",'<div class="block-settings-buttons clearfix">','<a href="#" onclick="return cp.saveSettings('+e+', event);" class="button button-purple block-settings-save"><i class="icon icon-check-square"></i>Сохранить</a>',"</div>","</div>","</div>","</td>","</tr>"];c("#cont_data").find("tbody").append(t.join("")),selectize()}),!1},dialog:function(e){return confirm(e)},indexation:function(e){if(void 0!==e&&(e.preventDefault?e.preventDefault():e.returnValue=!1),cp.dialog("Начать индексацию?")){c("#indexation-good").hide(),c("#loader").fadeIn();var t="/"+ADMIN_DIR+"/search/indexer/";c.ajax({url:t,type:"get",data:{start:0},success:function(e){"good"!=e?c.get(t,{start:e}):(c("#loader").fadeOut(),c("#indexation-good").show())},error:function(e){}})}},push:function(e){t.push(e)},pop:function(){return t.pop()},length:function(){return t.length}}}(jQuery);function doOnLoad(a){(category=new dhtmlXTreeObject("treeboxbox_tree","100%","100%",0)).setImagePath("/"+ADMIN_DIR+"/images/tree/"),category.enableDragAndDrop(!0),category.setEditStartAction(1/0),category.enableKeyboardNavigation(!0),category.enableMultiselection(!0),category.enableTreeLines(!0),category.makeAllDraggable(),category.attachEvent("onDrop",function(e,t,n,i,o){$.ajax({url:"/"+ADMIN_DIR+"/"+a+"/updateStructure",type:"post",data:{oid:e,pid:t}})}),category.attachEvent("onDblClick",function(e){})}function controlLink(e,t,n,i,o){switch(n){case"add":return'<a href="/'+ADMIN_DIR+"/"+e+"/"+t+"/add/"+i+'" class="control-icon icon icon-file-plus" title="Добавить подраздел" data-no-instant></a>';case"edit":return'<a href="/'+ADMIN_DIR+"/"+e+"/"+t+"/edit/"+i+'" class="control-icon icon icon-edit" title="Редактировать раздел" data-no-instant></a>';case"visible":return'<a href="/'+ADMIN_DIR+"/"+e+"/"+t+"/visible/"+i+'" class="control-icon icon icon-eye'+(0==o?"-off":"")+'" onclick="ajax_vis_toggle(this, 15, 0); return false;" title="Отображение страницы" data-no-instant></a>';case"delete":return'<a href="/'+ADMIN_DIR+"/"+e+"/"+t+"/del/"+i+'" class="control-icon icon icon-delete" title="Удалить раздел" onclick="return cp.dialog(\'Вы действительно хотите удалить раздел?\');" data-no-instant></a>'}}function buildTree(n,i){$.ajax({url:"/"+ADMIN_DIR+"/"+n+"/getStructure",type:"get",dataType:"JSON",success:function(e){if(category.deleteChildItems(0),e.length)for(var t in e)controls="",controls+='<span class="control-icons">',controls+=controlLink(n,i,"add",e[t].id),controls+=controlLink(n,i,"edit",e[t].id),controls+=controlLink(n,i,"visible",e[t].id,e[t].visible),controls+=controlLink(n,i,"delete",e[t].id),controls+="</span>",close=0,open=0,(leaf=0)==e[t].pid?(leaf="icon/home.svg",open="icon/home.svg",close="icon/home.svg"):1==e[t].dynamic?leaf="icon/application-code.svg":leaf="icon/file.svg",category.insertNewChild(e[t].pid,e[t].id,e[t].name+" "+controls,0,leaf,open,close);category.openOnItemAdding(!0)}})}!function(r){r.fn.timeoutClass=function(e,t){t=t||10;var n=this;setTimeout(function(){r(n).toggleClass(e)},t)},r.fn.extend({popover:function(e){this.defaults={};r.extend({},this.defaults,e);var i,t,n,o=!1,a={},l=r("#page-wrapper");return a.position=function(e){r(window).width();return{left:(n=r(e).hasClass("trigger-popover")?r(e):r(e).closest(".trigger-popover")).offset().left+n.width(),top:n.offset().top+n.height()+8}},a.hide=function(e){r(".popover.open").length?((t=r(".popover.open")).removeClass("animate"),setTimeout(function(){t.removeClass("open"),"function"==typeof e&&e.apply()},250)):"function"==typeof e&&e.apply()},l.on("click",function(e){!o&&!r(".popover.open").length||r(e.target).closest(".trigger-popover").length||r(e.target).closest(".popover").length||a.hide()}),r(window).resize(function(){a.hide()}),l.scroll(function(){!0===o&&(i+100<l.scrollTop()||i-100>l.scrollTop())&&a.hide()}),this.each(function(){r(this).on("click",function(e){e.preventDefault();var t,n=r(this).data("popover");o=!0,a.hide(function(){0==r("#popover-"+n).length?(t=r(template("tpl_"+n,{})),l.append(t)):t=r("#popover-"+n),r("#popover-"+n).hasClass("open")||(i=l.scrollTop(),t.css(a.position(e.target)),t.toggleClass("open").timeoutClass("animate"))})})})}})}(jQuery),function(n){window.template=function(e,t){return null!==n.getElementById(e)?Template7.compile(n.getElementById(e).innerHTML)(t||{}):""}}(document),$(document).ready(function(){$.upload={open:function(e,t,n,i){clearInterval(uploadOpenTimeout),uploadOpenTimeout=setTimeout(function(){upload._open(e,t,n,i)},200)},clearErrors:function(e){e.find(".error").removeClass("error"),e.find(".upload__errorList").addClass("hide").empty(),e.find(".hide-on-open").hide(),e.find(".tooltip").remove()}},$.upload.init=function(){var r="/"+ADMIN_DIR+"/meta/fileUpload";$(".js-fileupload").each(function(e,l){return function(e){var t=$(l),n=t.find(".js-fileupload-control").attr("id"),i=t.find(".js-fileupload-group").val(),o=t.find(".js-fileupload-settings").val();t.find(".js-fileupload-group").attr("name");t.data("action")&&(r=t.data("action"));var a=new qq.FineUploader({debug:!1,multiple:!0,element:document.getElementById(n),template:"upload-template",request:{accessKey:"file_key",endpoint:r,inputName:"file",includeExif:!1,defaultQuality:100,params:{groupid:i,settings:o}},deleteFile:{enabled:!0,forceConfirm:!1,endpoint:"/"+ADMIN_DIR+"/meta/filedelete"},thumbnails:{placeholders:{waitingPath:"/"+ADMIN_DIR+"/images/fine-uploader/waiting-generic.png",notAvailablePath:"/"+ADMIN_DIR+"/images/fine-uploader/not_available-generic.png"}},validation:{itemLimit:0,sizeLimit:2048e3},callbacks:{onComplete:function(e,t,n){this.setUuid(e,n.id)}}});a.addInitialFiles(initialFiles[i]||[]),t.on("click",".qq-upload-file-selector",function(e){e.preventDefault();var t=$(this).text(),n=$(this).closest(".attachments-list__item").index(),i=a.getUuid(n),o=Module.changeFileName(i,t);o&&a.setName(n,o)})}()})}});var d=document;function keyControls(){if($(".j-clipboard").length)new ClipboardJS(".j-clipboard",{text:function(e){return $(e).addClass("copied"),setTimeout(function(){$(e).removeClass("copied")},700),e.getAttribute("data-clipboard")}});$("body").on("click",".remove-trigger",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=this,n=$(t).attr("href");return $.post(n,function(){cp.notify("Удалено","info"),void 0!==$(t).attr("rel")&&0<$($(t).attr("rel")).length?$($(t).attr("rel")).remove():$(t).closest("tr").remove()}),!1}),$("body").on("click",".js-remove-item",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=this,n=$(t).attr("href");return $.post(n,function(){cp.notify("Удалено","info"),void 0!==$(t).attr("rel")&&0<$($(t).attr("rel")).length?$($(t).attr("rel")).remove():$(t).closest("tr").remove()}),!1}),$("body").on("click",".js-add-template",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=$(this).closest(".js-template-wrapper"),n=parseInt($(this).data("iteration")),i=$(this).data("template"),o={};void 0!==n&&(o.id=n,n+=-1,$(this).data("iteration",n)),t.append(template(i,o))}),$("body").on("keydown",".reducing-trigger",function(e){if(38==e.which||40==e.which){e.preventDefault();var t=$(this).data("reducing")||10,n=$(this).data("format"),i=parseInt($(this).val())||0,o=0;38==e.which?o=i+t:40==e.which&&(o=i-t),o<0&&(o=0),void 0!==n&&(o="?i%".replace("?i",o)),$(this).val(o)}}),$("body").on("keypress",".latin",function(e){if(/[^A-Za-z]/g.test(String.fromCharCode(e.keyCode)))return!1}),$("body").on("keypress",".integer",function(e){if([0,8,13,38,40].indexOf(e.which)<0&&(e.which<48||57<e.which))return!1}),$("body").on("keypress",".float",function(e){if([0,8,13,38,40,44,46].indexOf(e.which)<0&&(e.which<48||57<e.which))return!1})}function fileManager(){}function fullCalendar(){}function on_load(){if(fileManager(),$(".watch-datemask").mask("99/99/9999"),$(".watch-phonemask").mask("+ 7 (999) 999-99-99"),$(".watch-cartnumber").mask("999-999-999"),$("body").on("click",".js-size-delete",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,$(this).closest("tr").remove()}),$("body").on("click",".js-add-size",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=$(this).closest(".js-size-list").find("table").find("tbody"),n=parseInt($(this).data("iteration")),i=0;t.find("tr").each(function(){parseInt($(this).data("index"))>i&&(i=parseInt($(this).data("index")))}),i++,t.append(template("tpl_image_row",{index:i,button:!0,iteration:n}))}),$(".js-slider").length&&$(".js-slider").each(function(){var e=$(this).attr("id"),t=$(this).data("type"),n=$(this).data("value"),i=$(this).data("min"),o=$(this).data("max");slider(e,t,n,i,o)}),$(".js-map").length&&$(".js-map").each(function(){var e=$(this).data("element"),t=$(this).data("provider");mapConteiner(t,e)}),$(".js-redactor").length&&$(".js-redactor").each(function(){var e=$(this).attr("id"),t=$(this).data("type");_redactor.init(e,t)}),$(".js-editor").length&&$(".js-editor").each(function(){var e=$(this).attr("id"),t=$(this).data("editor"),n=$(this).data("hightlight");_editor.init(e,t,n)}),$(".js-table-toggle").length&&($(".js-table-toggle").on("click",function(e,t){e.preventDefault?e.preventDefault():e.returnValue=!1,t?cp.tableToggle($(this).data("toggle")):cp.tableToggle($(this).data("toggle"),e)}),$('.js-table-toggle[data-toggle-init="true"]').length&&$('.js-table-toggle[data-toggle-init="true"]').trigger("click",!0)),$("body").on("click",".js-toggle-binding",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=$(this);if(t.data("element").length){var n=$($(this).data("element"));t.toggleClass("on").toggleClass("off"),n.prop("readonly",!t.hasClass("on")),$('input[name="'+n.data("binding-name")+'"]').trigger("blur")}}),$(".js-binding").length&&$(".js-binding").each(function(){$(this).hasClass("js-binding-init")||binding($(this).data("binding-name"),$(this).data("binding-element"))}),$(".js-fileupload").length&&$.upload.init(),$("body").on("mouseenter",".js-structure-controll",function(e){$(this).find(".structure__control.animate").removeClass("animate")}),$("body").on("mouseleave",".js-structure-controll",function(e){$(this).find(".structure__control").addClass("animate")}),$("body").on("click",".menu-trigger",function(e){e.preventDefault(),$("#page").toggleClass("page-open");var t="visible";return $("#page").hasClass("page-open")||(t="hidden"),$("#overlay").css({visibility:t}),!1}),$("#meta_data").sortable({handle:".js-trigger-drag",pullPlaceholder:!1,bodyClass:"dragging",draggedClass:"dragged",containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',onDrop:function(e,t,n,i){e.removeClass("dragged").removeAttr("style"),$("body").removeClass("dragging")}}),$("body").on("mouseenter",".trigger-navigation",function(e){var t,n=$(this),i=$("#page"),o=n.attr("rel"),a="tooltip-"+n.attr("id");if(o&&!$("#"+a).length&&!i.hasClass("page-open")){var l=n.offset().top+10;(t=document.createElement("span")).id=a,t.innerHTML=o,t.className="navigation__tooltip navigation__tooltip_animate",t.style.top=l+"px",i.append(t),setTimeout(function(){$(t).removeClass("navigation__tooltip_animate")},30)}}),$("body").on("mouseleave",".trigger-navigation",function(e){var t="tooltip-"+$(this).attr("id");if($("#"+t).length){var n=$("#"+t);n.addClass("navigation__tooltip_animate"),setTimeout(function(){n.remove()},200)}}),$("body").on("click",".wrapper",function(e){$("#page").removeClass("page-open"),$("#overlay").css({visibility:"hidden"})}),$("body").on("mouseenter",".trigger-tooltip",function(e){$(this).data("xtitle",$(this).prop("title")),$(this).prop("title","")}),$("body").on("mouseleave",".trigger-tooltip",function(e){$(this).prop("title",$(this).data("xtitle")),$(this).data("xtitle","")}),$(".trigger-popover").popover(),$(".nestable-tree").length){var e=$(".nestable-tree").eq(0);if(void 0!==e.data("path")&&void 0!==e.data("group")){var o=e.data("path"),a=parseInt(e.data("group"));e.nestable({group:a,maxDepth:20,dragStop:function(e){var t,n,i;i=0,t=parseInt(e[0].id.split("-")[1]),n=parseInt(e[0].offsetParent.offsetParent.id.split("-")[1]),isNaN(n)&&(n=a),null!==e[0].nextElementSibling&&(i=parseInt(e[0].nextElementSibling.id.split("-")[1])),isNaN(t)||isNaN(n)||$.ajax({url:"/"+ADMIN_DIR+"/"+o+"/updateStructure",type:"post",data:{oid:t,pid:n,nid:i}})},afterExpand:function(e){var t=e[0].id.split("-")[1];$.removeCookie(o+"_collapse_"+t,{path:"/"})},afterCollapse:function(e){var t=e[0].id.split("-")[1];$.cookie(o+"_collapse_"+t,"1",{expires:30,path:"/"})}})}}}var initApp=function(){selectize(),datepicker(),metaCounter(),seoCrowl(),keyControls(),on_load(),cp.dropdown(),cp.tableToggleList(),cp.cleditor(),jscolor.install()};$(window).ready(function(){Raven.context(function(){initApp()})});